{% assign min = 1 %}
{% assign max = 9999999 %}
{% assign diff = max | minus: min %}
{% assign randomNumberPlot = "now" | date: "%N" | modulo: diff | plus: min %}

{% assign min = 1 %}
{% assign max = 9999999 %}
{% assign diff = max | minus: min %}
{% assign randomNumberSSIM = "now" | date: "%N" | modulo: diff | plus: min %}

<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="plot-tab" data-bs-toggle="tab" data-bs-target="#plot-{{randomNumberPlot}}" type="button" role="tab" aria-controls="plot" aria-selected="true">Plot</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="ssim-tab" data-bs-toggle="tab" data-bs-target="#ssim-{{randomNumberSSIM}}" type="button" role="tab" aria-controls="ssim" aria-selected="false">SSIM</button>
  </li>
</ul>
<div class="tab-content" id="myTabContent">
	{% if include.src  %}
	<div class="tab-pane fade show active" id="plot-{{randomNumberPlot}}" role="tabpanel" aria-labelledby="plot-tab">
		<iframe 
		  scrolling="no" 
		  margin="none" 
		  padding="none" 
		  seamless=seamless 
		  height="650" 
		  frameBorder="0"
		  style="border:0"
		  src="{{ include.src }}" 
		  width="800">
		</iframe>
	</div>
	
	{% else %}
	<div id="plot-{{randomNumberPlot}}" class="plotly-graph-div js-plotly-plot tab-pane fade show active" role="tabpanel"></div>
	
	
	{% raw %}
	<script type = "text/javascript" > require(["plotly"], function(Plotly) {
		window.PLOTLYENV = window.PLOTLYENV || {};
		if (document.getElementById("{% endraw %}plot-{{randomNumberPlot}}{% raw %}"
		)) {
			Plotly.newPlot("{% endraw %}plot-{{randomNumberPlot}}{% raw %}", 
							{% endraw %} {{ include.raw_json_file }} {% raw %},
				{"responsive": true} 
			).then(function() {

				var gd = document.getElementById("{% endraw %}plot-{{randomNumberPlot}}{% raw %}");
				var x = new MutationObserver(function(mutations, observer) {
					{
						var display = window.getComputedStyle(gd).display;
						if (!display || display === 'none') {
							{
								console.log([gd, 'removed!']);
								Plotly.purge(gd);
								observer.disconnect();
							}
						}
					}
				});

				// Listen for the removal of the full notebook cells
				var notebookContainer = gd.closest('#notebook-container');
				if (notebookContainer) {
					{
						x.observe(notebookContainer, {
							childList: true
						});
					}
				}

				// Listen for the clearing of the current output cell
				var outputEl = gd.closest('.output');
				if (outputEl) {
					{
						x.observe(outputEl, {
							childList: true
						});
					}
				}

			})
		};
	}); 
	{% endraw %} 
	</script>
		
	{% endif %}
	
  <div class="tab-pane fade" id="ssim-{{randomNumberSSIM}}" role="tabpanel" aria-labelledby="ssim-tab">
    <img src="{{ include.compare }}">
    <img src="{{ include.ssim }}">
  </div>
</div>

